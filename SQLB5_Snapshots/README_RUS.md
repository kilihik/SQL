
## Задание 00 — Let's create separate views for persons

| Задание 00: Let's create separate views for persons | |
|----------------------------------------------------|--|
| Директория для загрузки решений | ex00 |
| Файлы для загрузки | `day04_ex00.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Создай два представления в базе данных (с атрибутами, аналогичными исходной таблице), реализующие простую фильтрацию персон по полу. Присвойте представлениям соответствующие имена:

- v_persons_female (для лиц женского пола)
- v_persons_male (для лиц мужского пола)

## Задание 01 — From parts to common view

| Задание 01: From parts to common view | |
|--------------------------------------|--|
| Директория для загрузки решений | ex01 |
| Файлы для загрузки | `day04_ex01.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Используй 2 представления из Задания 00 и напиши SQL-запрос,  
который выведет имена женщин и мужчин в одном списке.  
Укажи сортировку списка по имени человека.  
Ниже приведен пример вывода.

| name |
|------|
| Andrey |
| Anna |
| ... |

## Задание 02 — "Store" generated dates in one place

| Задание 02: "Store" generated dates in one place | |
|-------------------------------------------------|--|
| Директория для загрузки решений | ex02 |
| Файлы для загрузки | `day04_ex02.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |
| Синтаксические конструкции SQL | `generate_series(...)` |

Создай представление базы данных с именем v_generated_dates, которое будет «хранить» сгенерированные даты с 1 января по 31 января 2022 года в типе DATE.  
Необходимо упорядочить данные по столбцу generated_date.

| generated_date |
|----------------|
| 2022-01-01 |
| 2022-01-02 |
| ... |

## Задание 03 — Find missing visit days with Database View

| Задание 03: Find missing visit days with Database View | |
|-------------------------------------------------------|--|
| Директория для загрузки решений | ex03 |
| Файлы для загрузки | `day04_ex03.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Напиши SQL-запрос, который возвращает пропущенные дни посещений людей за январь 2022 года.  
Для этой задачи используй представление v_generated_dates и отсортируй результат по столбцу missing_date.  
Пример вывода данных приведен ниже

| missing_date |
|--------------|
| 2022-01-11 |
| 2022-01-12 |
| ... |

## Задание 04 — Let's find something from Set Theory

| Задание 04: Let's find something from Set Theory | |
|-------------------------------------------------|--|
| Директория для загрузки решений | ex04 |
| Файлы для загрузки | `day04_ex04.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Напиши SQL-запрос, реализующий формулу (R − S) ∪ (S − R), где:

- R — таблица person_visits с фильтром по дате 2 января 2022 года,
- S — та же таблица person_visits, но с фильтром по дате 6 января 2022 года.

Вычисления должны выполняться над множествами значений столбца person_id, и в результате должен быть только этот столбец. Отсортируй вывод по person_id и сохрани итоговый запрос в представлении v_symmetric_union.

(\*) Честно говоря, определения «симметричного объединения» в теории множеств не существует. Это авторская интерпретация, основанная на правиле симметрической разности.

## Задание 05 — Let's calculate a discount price for each person

| Задание 05: Let's calculate a discount price for each person | |
|------------------------------------------------------------|--|
| Директория для загрузки решений | ex05 |
| Файлы для загрузки | `day04_ex05.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Создай представление `v_price_with_discount`, которое возвращает заказы человека с указанием:

- имени клиента (name),
- названия пиццы (pizza_name),
- реальной цены (price),
- столбца discount_price (рассчитывается по формуле price - price * 0.1, то есть с 10% скидкой).

Отсортируй результаты по имени клиента (name), названию пиццы (pizza_name) и приведи столбец discount_price к целочисленному типу (integer).

Пример результата представлен ниже.

| name | pizza_name | price | discount_price |
|------|------------|-------|----------------|
| Andrey | cheese pizza | 800 | 720 |
| Andrey | mushroom pizza | 1100 | 990 |
| ... | ... | ... | ... |

## Задание 06 — Materialization from virtualization

| Задание 06: Materialization from virtualization | |
|------------------------------------------------|--|
| Директория для загрузки решений | ex06 |
| Файлы для загрузки | `day04_ex06.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Создай материализованное представление mv_dmitriy_visits_and_eats (с включенными данными) на основе SQL-запроса, который находит название пиццерии, где Дмитрий был 8 января 2022 года и мог съесть пиццу дешевле 800 рублей (этот запрос можно найти в проекте SQLB3_Retrieving data, Задание 07).

Для самопроверки можешь выполнить SQL-запрос к материализованному представлению mv_dmitriy_visits_and_eats и сравнить результат с предыдущим запросом.

## Задание 07 — Refresh our state

| Задание 07: Refresh our state | |
|------------------------------|--|
| Директория для загрузки решений | ex07 |
| Файлы для загрузки | `day04_ex07.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |
| **Запрещено** | |
| Синтаксические конструкции SQL | Не используй прямые числовые значения для идентификаторов Primary Key, person and pizzeria |

Обновим данные в материализованном представлении mv_dmitriy_visits_and_eats (Задание 06).

- Добавь новый визит Дмитрия, соответствующий условиям представления, но с другой пиццерией (отличной от результата Задания 06)
- Обнови данные в mv_dmitriy_visits_and_eats

## Задание 08 — Just clear our database

| Задание 08: Just clear our database | |
|------------------------------------|--|
| Директория для загрузки решений | ex08 |
| Файлы для загрузки | `day04_ex08.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

После выполнения всех заданий у тебя осталось несколько виртуальных таблиц и материализованное представление.  
Тебе необходимо их удалить.