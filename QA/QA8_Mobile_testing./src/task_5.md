## **Установка и настройка Charles Proxy**

| Этап | Действие | Команда/Шаги | Примечания |
|------|----------|--------------|------------|
| **1. Установка** | Скачать и установить Charles | **macOS:** `brew install --cask charles`<br>**Windows/Linux:** [Скачать с сайта](https://www.charlesproxy.com/download/) ||
| **2. Запуск** | Запустить Charles | Открыть приложение Charles Proxy ||
| **3. Сертификат на ПК** | Установить корневой сертификат | В Charles: **Help → SSL Proxying → Install Charles Root Certificate** |![окружения телефона](/src/task_5/ts5.1.png)|
| | Настроить доверие (macOS) | 1. Открыть **Keychain Access**<br>2. Найти "Charles Proxy..."<br>3. Двойной клик → Trust → Always Trust ||
| **4. Настройка прокси** | Узнать IP компьютера | **macOS/Linux:** `ifconfig \| grep "inet "`<br>**Windows:** `ipconfig` ||
| **5. Настройка телефона** | Настроить Wi-Fi прокси | 1. Настройки → Wi-Fi → Ваша сеть<br>2. Прокси → Вручную<br>3. Хост: [IP компьютера]<br>4. Порт: 8888 |![окружения телефона](/src/task_5/ts5.2.png)|
| **6. Сертификат на телефон** | Скачать сертификат | 1. На телефоне: `chls.pro/ssl`<br>2. Скачать и установить ||
| | Настроить доверие (iOS) | Настройки → Основные → Доверие к сертификатам → Включить Charles ||
| **7. Настройка SSL** | Добавить домены для декодирования | В Charles: **Proxy → SSL Proxying Settings**<br>Добавить: Хост: `*`, Порт: `*` ||
| **8. Проверка** | Проверить соединение | 1. В Charles: **Start Recording**<br>2. На телефоне открыть любой сайт<br>3. Проверить трафик в Charles ||




### Функциональности снифферов

| Функциональность | Назначение | Описание | Пример применения для тестировщика |Screens|
|:---|:---|:---|:---|:---|
| **Фильтрация запросов (Filter)** | Быстро находить нужные данные в потоке трафика. | Ввод ключевого слова в поле "Filter" мгновенно скрывает из общего списка все запросы, не соответствующие условию (например, по домену или части URL). | 1. Сфокусироваться на трафике тестируемого приложения, убрав лишние системные запросы.<br>2. Быстро найти все вызовы к конкретному API-методу (например, /api/checkout).<br>3. Выделить запросы, содержащие в ответе определённое ключевое слово (например, "error"). ||
| **Работа с логами (Session)** | Запись, сохранение и повторный анализ сетевого взаимодействия. | Весь перехваченный трафик за один сеанс работы называется **Session**. Её можно сохранить, загрузить или очистить. | 1. **Фиксация сценария**: сохранить сессию с логами (.chls-файл) для отчёта о баге или передачи разработчику.<br>2. **Сравнение**: сохранить сессии "до" и "после" изменений в приложении для анализа различий.<br>3. **Пошаговая отладка**: изучать хронологию и взаимосвязи запросов в **Sequence View**. ||
| **Работа с зашифрованным трафиком (SSL Proxying)** | Расшифровка и просмотр содержимого HTTPS-запросов и ответов. | Без настройки **SSL Proxying** содержимое пакетов выглядит как нечитаемый зашифрованный текст. Для работы требуется установить сертификат Charles на устройство. | 1. Проверить, не передаются ли конфиденциальные данные (пароли, токены) в открытом виде в теле запроса.<br>2. Убедиться в правильности структуры JSON/XML в запросах и ответах защищённого API.<br>3. Диагностировать ошибки SSL-сертификатов, которые могут возникать между клиентом и сервером. ||
| **Map Remote** | Подмена URL-адреса назначения «на лету». | Перенаправляет запросы с одного домена или пути на другой. Например, можно заставить приложение обращаться к тестовому стенду, а не к продакшену. | 1. **Тестирование нового API**: перенаправить трафик api.prod.com на api.stage.com для проверки работы клиента с обновлённым бэкендом.<br>2. **Использование разных сред**: подменить адрес CDN, чтобы загружать ресурсы (картинки, скрипты) из другого источника. ||
| **Breakpoint** | Ручной перехват и модификация запроса или ответа перед его отправкой. | Устанавливает "точку останова" на определённый запрос, приостанавливая его и позволяя вручную изменить любую часть (заголовки, тело, статус код). | 1. **Тестирование обработки ошибок**: изменить успешный код ответа сервера (200 OK) на 500 Internal Server Error и проверить, как приложение отреагирует на сбой.<br>2. **Подмена данных**: в ответе от сервера изменить цену товара или имя пользователя для проверки корректного отображения на экране.<br>3. **Эмуляция разных сценариев**: отправить заведомо невалидный JSON и посмотреть, как сервер или клиент его обрабатывают. |[![t5_breakpoint_namechange.jpg.png](https://iimg.su/s/10/u2F7rSrxG2oWDhgoOu9tovWpHfCS880QCJ5ZBPlJ.png)](https://iimg.su/i/2F7rSr) [![t5_breakpoint_request.jpg.png](https://iimg.su/s/10/uOsTUBYxpQ373grc01AXk1BMWyFIDMPzeyaV56Uj.png)](https://iimg.su/i/OsTUBY)|
| **Rewrite** | Автоматическое изменение запросов и ответов по заданным правилам. | Гибкий инструмент для создания правил вида **"Условие → Действие"**. Позволяет менять заголовки, тело, параметры без ручного вмешательства для каждого запроса. | 1. **Постоянная подмена данных**: для всех ответов автоматически заменять значение поля "price" на 0, чтобы тестировать поведение при нулевой стоимости.<br>2. **Добавление заголовков**: ко всем запросам к определённому домену добавлять заголовк авторизации Authorization: Bearer test_token.<br>3. **Исправление данных на лету**: заменить некорректный URL картинки в ответе сервера на рабочий для проверки отображения. |[![t5_rewrite.jpg.png](https://iimg.su/s/10/uYgmP2ExcyZkKRD9NnStwYWjNcohsZNftASmyhqL.png)](https://iimg.su/i/YgmP2E)|
| **Throttling** | Имитация работы приложения в условиях медленных или нестабильных сетей. | Искусственное ограничение пропускной способности (скорости загрузки/отдачи), добавление задержки и указание процента потери пакетов. | **Тестирование UX на медленном соединении**: Меню: Proxy → Throttle Settings...<br> Включить: Поставить галочку Enable Throttling.<br> Выбрать профиль: Использовать предустановку (например, 3G) или создать свой, указав низкую скорость (Bandwidth) и высокую задержку (Latency).<br> Проверить: Обновить сайт OZON и наблюдать за замедленной загрузкой.|[![t5_throttling.jpg](https://iimg.su/s/10/uq1wQdpxXialA0OfTDMWd9mwz1cr9wS0CuWBsjiF.jpg)](https://iimg.su/i/q1wQdp)|

