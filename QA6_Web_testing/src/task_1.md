# Таблица: Основные уровни Трехзвенной архитектуры

| Уровень | Основная функция | Ключевые компоненты и технологии | Примеры и примечания |
| :---: | :---: | :---: | :---: |
| **Клиентский уровень (Presentation Layer)** | Взаимодействие с пользователем, отображение данных и получение пользовательского ввода. | - Пользовательский интерфейс (UI)<br>- Веб-браузеры<br>- Фронтенд-фреймворки (React, Angular, Vue.js)<br>- Мобильные SDK (Swift, Kotlin)<br>- Десктопные фреймворки (Electron, WPF) | - **Веб-браузер:** Отображает HTML, CSS, JavaScript.<br>- **Мобильное приложение:** Нативное приложение для iOS или Android.<br>- **Десктопная программа:** Приложение для Windows, macOS. |
| **Сервер приложений (Application Layer)** | Обработка бизнес-логики, правил приложения и координация между клиентским уровнем и уровнем данных. | - Веб-серверы (Nginx, Apache)<br>- Серверы приложений (Node.js, Tomcat)<br>- API (REST, GraphQL)<br>- Микросервисы<br>- Бэкенд-фреймворки (Spring, Django, Express.js) | - **Интернет-магазин:** Обработка заказов, управление корзиной, интеграция с платёжными системами.<br>- Отвечает за безопасность, аутентификацию и целостность данных. |
| **Сервер данных (Data Layer)** | Надёжное хранение, управление и предоставление доступа к данным. | - Системы управления базами данных (СУБД): MySQL, PostgreSQL, MongoDB<br>- Файловые хранилища<br>- Кэширующие серверы (Redis)<br>- Data Warehouses | - **Реляционная БД (MySQL):** Для структурированных данных с четкими схемами.<br>- **NoSQL БД (MongoDB):** Для неструктурированных или полуструктурированных данных.<br>- Ключевую роль играет в производительности и масштабируемости. |

---

# Таблица: Многоуровневой архитектуры

| Доп. уровни | Назначение | Компоненты | Функции |
| :------: | :------: | :------: | :------: |
| **Уровень интеграции (Integration Tier)** | Взаимодействие с внешними системами | - API Gateway<br>- ESB (Enterprise Service Bus)<br>- Микросервисы интеграции | - Оркестрация сервисов<br>- Преобразование данных<br>- Маршрутизация запросов<br>- Агрегация данных из разных источников |
| **Уровень кэширования (Caching Tier)** | Повышение производительности | - Redis Cluster<br>- Memcached <br>- CDN (Content Delivery Network) | - Кэширование часто запрашиваемых данных<br>- Снижение нагрузки на БД<br>- Ускорение отклика приложения |
| **Уровень очередей (Message Queue Tier)** | Асинхронная обработка задач | - RabbitMQ<br>- Apache Kafka<br>- AWS SQS | - Буферизация запросов<br>- Обеспечение надежной доставки сообщений<br>- Обработка фоновых задач |

---
![схема](scrinu/scri1.png)

Другие веб-приложения с похожей архитектурой:  
- Wildberries  
- AliExpress  
- Amazon
- Yandex Market

## Анализ компонентов и тестирование

| Структура компонента | 1-2 наиболее вероятных типа сбоя | Как проявляется для пользователя | Тип нефункционального тестирования |
|---------------------|----------------------------------|----------------------------------|-----------------------------------|
| **Сервер приложений (микросервисы)** | 1. Утечка памяти в Java-микросервисе<br>2. Сетевой разрыв между микросервисами | 1. Медленная загрузка страниц товаров<br>2. Ошибка "Невозможно добавить в корзину" | Стресс-тестирование<br>Тестирование отказоустойчивости |
| **База данных PostgreSQL** | 1. Перегрузка запросами в час распродаж<br>2. Сбой репликации | 1. Ошибка при оформлении заказа<br>2. Расхождение данных в заказах | Нагрузочное тестирование<br>Тестирование восстановления БД |
| **Поисковый движок Elasticsearch** | 1. Переполнение индексов<br>2. Сетевые задержки в кластере | 1. Поиск не находит товары<br>2. Медленные результаты поиска | Производительности тестирование<br>Тестирование масштабируемости |
| **Кэш Redis Cluster** | 1. Падение узла кластера<br>2. Истечение TTL кэша | 1. Медленная загрузка каталога<br>2. Показ устаревших цен | Тестирование отказоустойчивости<br>Тестирование согласованности |

## Сравнение: «Горячий» vs «Холодный» резерв

| Критерий                | Горячий резерв (Hot Standby)                                             | Холодный резерв (Cold Standby)                                           |
|-------------------------|--------------------------------------------------------------------------|--------------------------------------------------------------------------|
| **Надёжность**          | Очень высокая — готов к мгновенному переключению                        | Низкая — требует времени на запуск и восстановление                     |
| **Синхронизация данных**| В реальном времени (например, PostgreSQL streaming replication + Patroni)| По расписанию: бэкапы раз в 1–24 часа (WAL-G, pgBackRest)              |
| **Время переключения**  | 1–15 сек (Patroni автоматически выбирает нового мастера)                | от 5 минут до нескольких часов (зависит от объёма данных и команды)     |
| **Стоимость**           | Высокая — 2× железо + сетевой трафик репликации + лицензии               | Низкая — ресурсы простаивают, хранение бэкапов дёшево                   |
| **Плюсы**               | - RTO/RPO ≈ 0<br>- Подходит для критичных сервисов (платежи, заказы)<br>- Полная автоматизация | - Подходит для аналитики, логов, архивов<br>- Прост в эксплуатации     |
| **Минусы**              | - Сложность настройки и мониторинга<br>- Риск split-brain при сетевых сбоях | - Потеря данных за период между бэкапами<br>- Не подходит для OLTP     |

Конечно! Вот **краткий сценарий проверки отказоустойчивости** для компонента **PostgreSQL-кластер (order-service)** при использовании **«горячего» резерва**:

---

###  Краткий сценарий тестирования

Компонент: PostgreSQL (управление через Patroni).  
Цель: Проверить автоматический failover без потери данных.

####  Шаги:
1. Запустить нагрузку: 100 RPS (30% — создание заказов).  
2. Принудительно остановить мастер-ноду (`systemctl stop patroni`).  
3. Дождаться автоматического переключения (ожидаем: ≤10 сек).  
4. Продолжить нагрузку 1 минуту.  
5. Сверить: все заказы сохранены, ошибок < 0.5%.

#### Контролируемые метрики:
| Метрика | Цель |
|:--------:|:------:|
| **RTO** | ≤ 10 с |
| **RPO** | = 0 (ни одного потерянного заказа) |
| **% HTTP 5xx** | ≤ 0.5% |
| **WAL lag до отказа** | ≤ 100 мс |
---