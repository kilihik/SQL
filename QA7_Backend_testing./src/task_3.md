 # Реляционных (SQL) vs. Нереляционных (NoSQL) БД
| Критерий | Реляционные (SQL) | Нереляционные (NoSQL) |
| :---: | :---: | :---: |
|  Модель данных  | Таблицы со строками и столбцами. Жесткая структура. | Документы, ключ-значение, графы, колонки. Гибкая структура. |
|  Схема  |  Схема сначала (Schema-on-Write):  Схема строго определена до записи данных. Изменение сложно. |  Схема при чтении (Schema-on-Read):  Структура данных гибкая, интерпретируется при чтении. |
|  Принципы  |  ACID:  Атомарность, Согласованность, Изолированность, Долговечность. |  CAP/BASE:  Доступность, Устойчивость к разделению, Eventual Согласованность. |
|  Масштабируемость  |  Вертикальное (Scale Up):  Увеличение мощности сервера (CPU, RAM, SSD). |  Горизонтальное (Scale Out):  Добавление новых серверов в кластер. |
|  Язык запросов  | Стандартизированный  SQL  (Structured Query Language). | Собственные API и языки запросов для каждой СУБД. |
|  Связи между данными  | Реализуются через внешние ключи (Foreign Keys) и JOIN-операции. | Встроены в структуру данных (документы) или органичны для модели (графы). JOIN-ы сложны или отсутствуют. |
|  Цель  | Целостность данных и надежность транзакций. | Производительность, масштабируемость и гибкость. |
| Плюсы |  - Надежность и ACID: Гарантия, что транзакция будет выполнена полностью или не выполнена вовсе. Данные всегда в согласованном состоянии.<br>- Мощные и гибкие запросы: SQL позволяет делать сложные выборки с JOIN, агрегациями и фильтрами из нескольких таблиц.<br>- Снижение избыточности:  Нормализация данных минимизирует дублирование.<br>- Стандартизация:  Знание SQL позволяет работать с любой реляционной СУБД.<br>- Зрелость и сообщество:  Огромная история, проверенные практики, мощная поддержка.| - Горизонтальная масштабируемость:  Легко распределить нагрузку на множество дешевых серверов.<br>- Гибкость:  Можно быстро менять структуру данных, не останавливая систему.<br>- Высокая производительность:  Оптимизированы под конкретные сценарии (запись, чтение, графы).<br>- Отказоустойчивость:  Репликация данных across множество узлов обеспечивает устойчивость к сбоям.<br>-  Подходят для Big Data и неструктурированных данных:  Идеальны для логов, контента, данных IoT. |
| Минусы | - Сложность горизонтального масштабирования:  Кластеризация и шардирование — нетривиальные задачи.<br>- Жесткость схемы:  Изменение структуры БД на работающей системе требует миграций и может привести к простоям.<br>- Проблемы с производительностью:  При неправильном проектировании или очень высоких нагрузках JOIN и блокировки могут стать "бутылочным горлышком".<br>- Неэффективность для неструктурированных данных:  Плохо подходят для хранения иерархических или постоянно меняющихся данных. | Eventual Consistency:  Данные на разных узлах могут быть несогласованны короткое время. Не подходит для финансовых операций.<br>- Отсутствие стандартов:  Каждая СУБД имеет свой API, что усложняет смену технологии.<br>- Сложности с объединением данных:  Аналогов JOIN в SQL нет, что приводит к дублированию данных или необходимости делать несколько запросов.<br>- Меньшая зрелость:  По сравнению с SQL, некоторые инструменты и сообщества менее развиты. |

# Сравнительная таблица: MySQL vs PostgreSQL

| Критерий | MySQL | PostgreSQL |
|----------|-------|------------|
|  Философия  | "Быстро, просто и надежно" - ориентация на скорость в веб-сценариях | "Самая продвинутая открытая СУБД" - ориентация на стандарты и расширяемость |
|  Лицензия  | Принадлежит Oracle, вопросы о полной открытости | Полностью открытая (BSD-style), больше свободы |
|  Движки хранения  | Поддерживает несколько движков (InnoDB, MyISAM) - гибкость под разные задачи | Один основной, но невероятно развитый движок |
|  Стандарты SQL  | Традиционно менее строгое следование, но ситуация улучшается | Строгое следование стандартам |
|  Расширяемость  | Базовая функциональность | Позволяет создавать собственные типы данных, операторы, функции, процедурные языки (PL/pgSQL, PL/Python) |
|  Поддержка сложных типов  | Базовая поддержка JSON | Нативная поддержка массивов,  JSONB  (бинарный JSON с индексацией!), hstore, геоданных (PostGIS), сетевых адресов |
|  Производительность  | Быстрее в простых SELECT и INSERT "из коробки" | Превосходит в сложных запросах, операциях с большими данными, параллельных транзакциях |
|  Индексы  | B-tree, Hash, Full-Text | B-tree, Hash,  GIN, GiST, BRIN  (для разных типов данных) |
|  Оконные функции, CTE  | Есть, но появились позже | Полноценная и давняя поддержка |
|  Репликация  | Классическая master-slave, групповая | Физическая и логическая репликация, более гибкая |
|  Типичное использование  | Веб-сайты, высоконагруженные чтения, LAMP-стек | Сложные приложения, геоданные, аналитика, fintech, enterprise-решения |
|  Репутация  | "Рабочая лошадка" для стандартных веб-проектов | "Конструктор" для сложных и нетривиальных задач |
|  Сообщество  | Огромное, благодаря долгой истории в связке LAMP | Активное, растущее, ориентированное на enterprise-уровень |


# БД для OZON
Единий тип Бд не сможет оптимально работать со всем функционалом маркетплейса. Ozon будет эффективнее использовать гибридный подход, сочетающий реляционные (SQL) и нереляционные (NoSQL) базы данных. Так как для работы с денежными операциями и заказами нужен надежный сейф — это реляционная БД. Она не позволит ошибиться в счете или потерять детали заказа. А для работы с гигантским каталогом товаров, который постоянно меняется, и корзинами покупателей нужен большой, удобный и быстро пополняемый склад — это NoSQL БД.
# Ключевые функции
| Функция | Каталог товаров и поиск | оформалкние и обработка заказа | Корзина и пользовательские сессии |
| :-------: | :-------: | :-------: | :-------: |
| Описание | Пользователь просматривает категории, фильтрует товары по множеству параметров, ищет товары по названию. | Пользователь добавляет товары в корзину, оформляет заказ, выбирает способ оплаты и доставки. Система резервирует товары, списывает средства, формирует заказ. | Хранение временных данных о товарах, добавленных в корзину, а также данных активной сессии пользователя. |
| Используемые данные | - Данные о товарах: id товара, название, описание, цена, скидка, остатки на складах.<br>- Атрибуты товаров: цвет, размер, бренд, рейтинг, технические характеристики (которые могут сильно отличаться для разных категорий).<br>-Медиа-контент: ссылки на изображения, видео. |- Данные заказа: номер заказа, статус, дата создания, общая сумма.<br>- Состав заказа: список товаров, количество, цена на момент заказа.<br>- Данные о транзакциях: id транзакции, сумма, статус оплаты.<br>- Данные о клиенте и доставке: ФИО, адрес, телефон.|- ID сессии пользователя.<br>- Список ID товаров в корзине и их количество. |
| БД | Нереляционная (NoSQL), например, документная или поисковая. | Реляционная (SQL), например, PostgreSQL или MySQL. | Нереляционная (NoSQL), например, ключ-значение (Redis).|
| Аргумент | - Гибкая схема: Атрибуты товаров из разных категорий легко хранить в виде документов без необходимости создания сложных, разреженных таблиц.<br>- Масштабируемость: Каталог товаров огромен и постоянно растет. NoSQL БД легко масштабируются горизонтально, добавляя новые серверы.<br>- Производительность поиска и агрегации: Специализированные NoSQL-движки как Elasticsearch идеально подходят для полнотекстового поиска и сложной фильтрации по множеству полей.| - Транзакционность и целостность данных: Критически важно обеспечить согласованность данных. Операция "создать заказ -> заблокировать товары на складе -> списать деньги" должна быть атомарной (ACID). SQL-БД гарантируют это.<br>- Сложные связи: Данные заказа тесно связаны с данными о пользователе, товарах и платежами. Связи "один-ко-многим" и ссылочная целостность легко реализуются в реляционной модели.<br>- Надежность: Потеря или corruption данных о заказе или платеже недопустима. SQL-системы истоr>-рически надежны для таких задач. | - Высокая скорость записи и чтения: Redis, работающая в оперативной памяти, обеспечивает мгновенный отклик при добавлении товара в корзину.<br>- Временность данных: Данные корзины часто имеют TTL (время жизни). NoSQL БД удобно поддерживают автоматическое удаление данных по истечении срока.<br>- Простая структура данных: Данные корзины имеют простую структуру (ключ - user_session_id, значение - список товаров), что идеально для модели "ключ-значение". |

# Тест- кейсы 

|  Тип БД / Название кейса  | Нереляционная БД. Проверка горизонтального масштабирования | Реляционная БД. Проверка консистентности данных при откате транзакции | Нереляционная БД. Проверка TTL для данных корзины |
| :---: | :---: | :---: | :---: |
|  Цель  | Убедиться, что при добавлении новых серверов с данными каталога система сохраняет производительность. | Убедиться, что в случае ошибки при оформлении заказа все изменения в рамках транзакции откатываются, и данные остаются в согласованном состоянии. | Убедиться, что данные корзины автоматически удаляются по истечении заданного времени неактивности |
|  Условие  | Каталог содержит миллионы товаров, распределенных по нескольким шардам | Пользователь авторизован, в корзине товар. | Пользователь добавил товары в корзину. |
|  Шаги  | 1. Добавить в каталог крупную партию новых товаров (100k+ записей).<br>2. Во время нагрузки выполнять фоновые операции чтения с высоким RPS. | 1. Инициировать создание заказа через API.<br>2. На этапе списания средств искусственно вызвать ошибку (например, симулировать отказ платежного шлюза). | 1. Сымитировать прохождение интервала TTL (например, изменив системное время или дождавшись реального истечения срока).<br>2. Попытаться получить данные корзины для этого пользователя. |
|  Ожидаемый результат  | - Операции записи новых товаров успешно обрабатываются.<br>- Операции чтения не прерываются, их latency не превышает допустимых пределов.<br>- Новые товары становятся доступны для поиска сразу после добавления. | - Заказ не создается в системе.<br>- Товары не резервируются на складе (остатки остаются прежними).<br>- Деньги не списываются с баланса пользователя.<br>- В логах системы фиксируется откат транзакции. | - По истечении TTL корзина пользователя пуста. Данные удалены из БД.<br>- При повторном добавлении товаров создается новая корзина. |